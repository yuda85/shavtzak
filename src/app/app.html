<div style="padding: 16px; max-width: 600px; margin: 0 auto;">
  <h1>שבצק</h1>

  <!-- Vehicle Management -->
  <mat-card class="section-divider">
    <mat-card-header>
      <mat-card-title>ניהול רכבים</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div style="display: flex; gap: 8px; margin-bottom: 16px;">
        <mat-form-field class="full-width">
          <mat-label>כינוי רכב</mat-label>
          <input matInput [formControl]="vehicleDesignationControl">
          @if (vehicleDesignationControl.invalid && vehicleDesignationControl.touched) {
            <mat-error>נדרש כינוי רכב</mat-error>
          }
        </mat-form-field>
        <mat-form-field class="full-width">
          <mat-label>מספר רכב</mat-label>
          <input matInput [formControl]="vehicleIdControl" maxlength="9" type="number">
          @if (vehicleIdControl.invalid && vehicleIdControl.touched) {
            @if (vehicleIdControl.hasError('required')) {
              <mat-error>נדרש מספר רכב</mat-error>
            }
            @if (vehicleIdControl.hasError('invalidVehicleNumber')) {
              <mat-error>מספר רכב חייב להיות בין 5-9 ספרות</mat-error>
            }
          }
        </mat-form-field>
      </div>
      <button mat-raised-button color="primary" (click)="addVehicle()" class="full-width" 
              [disabled]="vehicleDesignationControl.invalid || vehicleIdControl.invalid">
        הוסף רכב
      </button>

      @if (vehicles$ | async; as vehicles) {
        @if (vehicles.length > 0) {
          <mat-list>
            @for (vehicle of vehicles; track vehicle.vehicleId) {
              <mat-list-item>
                <div matListItemTitle>{{ vehicle.designation }} {{ vehicle.vehicleId }}</div>
                <button mat-icon-button (click)="removeVehicle(vehicle.vehicleId)" matListItemMeta>
                  <mat-icon>delete</mat-icon>
                </button>
              </mat-list-item>
              <mat-divider></mat-divider>
            }
          </mat-list>
        }
      }
    </mat-card-content>
  </mat-card>

  <!-- People Management -->
  <mat-card class="section-divider">
    <mat-card-header>
      <mat-card-title>ניהול אנשים</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div style="display: flex; gap: 8px; margin-bottom: 16px;">
        <mat-form-field class="full-width">
          <mat-label>שם מלא</mat-label>
          <input matInput [formControl]="personNameControl">
          @if (personNameControl.invalid && personNameControl.touched) {
            @if (personNameControl.hasError('required')) {
              <mat-error>נדרש שם מלא</mat-error>
            }
            @if (personNameControl.hasError('minWords')) {
              <mat-error>שם חייב להכיל לפחות 2 מילים</mat-error>
            }
          }
        </mat-form-field>
        <mat-form-field class="full-width">
          <mat-label>מספר אישי</mat-label>
          <input matInput [formControl]="personIdControl" maxlength="7" type="number">
          @if (personIdControl.invalid && personIdControl.touched) {
            @if (personIdControl.hasError('required')) {
              <mat-error>נדרש מספר אישי</mat-error>
            }
            @if (personIdControl.hasError('invalidPersonId')) {
              <mat-error>מספר אישי חייב להיות 7 ספרות בדיוק</mat-error>
            }
          }
        </mat-form-field>
      </div>
      <button mat-raised-button color="primary" (click)="addPerson()" class="full-width"
              [disabled]="personNameControl.invalid || personIdControl.invalid">
        הוסף אדם
      </button>

      @if (people$ | async; as people) {
        @if (people.length > 0) {
          <mat-list>
            @for (person of people; track person.idNumber) {
              <mat-list-item>
                <div matListItemTitle>{{ person.fullName }} {{ person.idNumber }}</div>
                <button mat-icon-button (click)="removePerson(person.idNumber)" matListItemMeta>
                  <mat-icon>delete</mat-icon>
                </button>
              </mat-list-item>
              <mat-divider></mat-divider>
            }
          </mat-list>
        }
      }
    </mat-card-content>
  </mat-card>

  <!-- Assignment -->
  <mat-card class="section-divider">
    <mat-card-header>
      <mat-card-title>שיבוץ</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-form-field class="full-width" style="margin-bottom: 16px;">
        <mat-label>רכב</mat-label>
        <input matInput [formControl]="assignmentVehicleControl" [matAutocomplete]="vehicleAuto">
        <mat-autocomplete #vehicleAuto="matAutocomplete" [displayWith]="displayVehicle">
          @for (vehicle of filteredVehicles$ | async; track vehicle.vehicleId) {
            <mat-option [value]="vehicle">
              {{ vehicle.designation }} {{ vehicle.vehicleId }}
            </mat-option>
          }
        </mat-autocomplete>
      </mat-form-field>

      <mat-form-field class="full-width" style="margin-bottom: 16px;">
        <mat-label>אדם</mat-label>
        <input matInput [formControl]="assignmentPersonControl" [matAutocomplete]="personAuto">
        <mat-autocomplete #personAuto="matAutocomplete" [displayWith]="displayPerson">
          @for (person of filteredPeople$ | async; track person.idNumber) {
            <mat-option [value]="person">
              {{ person.fullName }} {{ person.idNumber }}
            </mat-option>
          }
        </mat-autocomplete>
      </mat-form-field>

      <mat-checkbox [formControl]="assignmentStayControl" style="margin-bottom: 16px;">
        שהיה
      </mat-checkbox>

      <button mat-raised-button color="primary" (click)="addAssignment()" class="full-width">
        הוסף לשיבוץ
      </button>
    </mat-card-content>
  </mat-card>

  <!-- Text Output -->
  <mat-card class="output-section">
    <mat-card-header>
      <mat-card-title>פלט</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <pre style="white-space: pre-wrap; font-family: monospace; background: #f5f5f5; padding: 16px; border-radius: 4px; min-height: 100px;">{{ output$ | async }}</pre>
      <div style="display: flex; gap: 8px; margin-top: 16px;">
        <button mat-raised-button color="accent" (click)="copyOutput()" class="full-width">
          העתק פלט
        </button>
        @if (canShare()) {
          <button mat-raised-button (click)="shareOutput()" class="full-width">
            שיתוף
          </button>
        }
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Additional Actions -->
  <mat-card class="section-divider">
    <mat-card-header>
      <mat-card-title>פעולות</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div style="display: flex; flex-direction: column; gap: 8px;">
        <button mat-raised-button (click)="exportData()">
          ייצא JSON
        </button>
        <input type="file" accept=".json" (change)="importData($event)" style="display: none;" #fileInput>
        <button mat-raised-button (click)="fileInput.click()">
          ייבא JSON
        </button>
        <button mat-raised-button color="warn" (click)="clearAll()">
          נקה הכל
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>
